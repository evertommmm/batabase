<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Pro - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #0f172a; color: #e2e8f0; }
        .card { background-color: #1e293b; border: 1px solid #334155; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-blue-500">NEXUS PRO</h1>
                <p class="text-gray-400">Gerenciamento de Chaves & Autenticação</p>
            </div>
            <div id="login-status" class="text-sm bg-green-900/30 text-green-400 px-3 py-1 rounded-full border border-green-800">
                <i class="fas fa-shield-alt mr-2"></i>Admin Conectado
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="card p-6 rounded-xl">
                <p class="text-gray-400 text-sm mb-1">Total de Chaves</p>
                <h2 id="stat-total" class="text-3xl font-bold">0</h2>
            </div>
            <div class="card p-6 rounded-xl">
                <p class="text-gray-400 text-sm mb-1">Total de Usos</p>
                <h2 id="stat-uses" class="text-3xl font-bold">0</h2>
            </div>
            <div class="card p-6 rounded-xl">
                <p class="text-gray-400 text-sm mb-1">Status da API</p>
                <h2 class="text-3xl font-bold text-green-500">ONLINE</h2>
            </div>
        </div>

        <!-- Actions -->
        <div class="card p-6 rounded-xl mb-8">
            <h3 class="text-xl font-bold mb-4">Gerar Nova Chave</h3>
            <div class="flex flex-wrap gap-4">
                <select id="key-days" class="bg-slate-800 border border-slate-700 rounded px-4 py-2 outline-none focus:border-blue-500">
                    <option value="0">Vitalícia</option>
                    <option value="1">1 Dia</option>
                    <option value="7">7 Dias</option>
                    <option value="30">30 Dias</option>
                </select>
                <input id="key-desc" type="text" placeholder="Descrição (ex: Cliente João)" class="bg-slate-800 border border-slate-700 rounded px-4 py-2 flex-1 outline-none focus:border-blue-500">
                <button onclick="createKey()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded font-bold transition">
                    <i class="fas fa-plus mr-2"></i>Gerar Key
                </button>
            </div>
        </div>

        <!-- Keys Table -->
        <div class="card rounded-xl overflow-hidden">
            <div class="p-6 border-b border-slate-700 flex justify-between items-center">
                <h3 class="text-xl font-bold">Chaves Ativas</h3>
                <button onclick="loadKeys()" class="text-blue-400 hover:text-blue-300"><i class="fas fa-sync-alt"></i></button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-slate-800/50 text-gray-400 text-sm">
                        <tr>
                            <th class="p-4">Chave</th>
                            <th class="p-4">Expiração</th>
                            <th class="p-4">Usos</th>
                            <th class="p-4">HWID</th>
                            <th class="p-4">Ações</th>
                        </tr>
                    </thead>
                    <tbody id="keys-table" class="divide-y divide-slate-700">
                        <!-- Chaves serão inseridas aqui -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_PASS = prompt("Digite a senha administrativa:") || "admin123456";

        async function apiCall(endpoint, method = 'GET', body = null) {
            const options = {
                method,
                headers: { 
                    'Content-Type': 'application/json',
                    'admin-password': ADMIN_PASS
                }
            };
            if (body) options.body = JSON.stringify(body);
            const res = await fetch(endpoint, options);
            return res.json();
        }

        async function loadKeys() {
            const data = await apiCall('/api/admin/keys');
            const stats = await apiCall('/api/admin/stats');
            
            document.getElementById('stat-total').innerText = data.keys.length;
            document.getElementById('stat-uses').innerText = stats.stats.total_uses || 0;

            const tbody = document.getElementById('keys-table');
            tbody.innerHTML = data.keys.map(k => `
                <tr class="hover:bg-slate-800/30 transition">
                    <td class="p-4 font-mono text-blue-400">${k.key}</td>
                    <td class="p-4 text-sm">${k.expires_at ? new Date(k.expires_at).toLocaleDateString() : 'Vitalícia'}</td>
                    <td class="p-4">${k.uses}</td>
                    <td class="p-4 text-xs text-gray-500">${k.hwid || 'Não vinculado'}</td>
                    <td class="p-4">
                        <button onclick="deleteKey('${k.key}')" class="text-red-500 hover:text-red-400"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        async function createKey() {
            const days = parseInt(document.getElementById('key-days').value);
            const description = document.getElementById('key-desc').value;
            const res = await apiCall('/api/admin/keys/create', 'POST', { days, description });
            if (res.success) {
                alert("Chave criada: " + res.key);
                loadKeys();
            }
        }

        async function deleteKey(key) {
            if (confirm("Deseja deletar a chave " + key + "?")) {
                await apiCall('/api/admin/keys/' + key, 'DELETE');
                loadKeys();
            }
        }

        loadKeys();
    </script>
</body>
</html>
